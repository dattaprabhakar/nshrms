<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HRMS Portal{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root { /* CSS Variables for easy theming */
            --sidebar-width: 260px; --sidebar-bg: #1e293b; --sidebar-link-color: #cbd5e1;
            --sidebar-link-hover-bg: #334155; --sidebar-link-active-bg: #0ea5e9;
            --sidebar-link-active-color: #ffffff; --dropdown-bg: #293548;
            --dropdown-item-hover-bg: #3e4f66; --main-bg: #f1f5f9; --card-border-color: #e2e8f0;
            --text-muted-color: #64748b;
        }
        body { background-color: var(--main-bg); display: flex; }
        #sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background-color: var(--sidebar-bg); padding-top: 0; /* Remove top padding */ overflow-y: auto; transition: width 0.3s ease; z-index: 1030; display: flex; flex-direction: column; }
        #sidebar .nav-link { color: var(--sidebar-link-color); padding: 0.75rem 1.5rem; display: flex; align-items: center; font-size: 0.95rem; white-space: nowrap; border-left: 3px solid transparent; /* For active indicator */ transition: background-color 0.2s ease, border-left-color 0.2s ease; }
        #sidebar .nav-link i { margin-right: 0.8rem; font-size: 1.2rem; width: 25px; text-align: center; }
        #sidebar .nav-link:hover { background-color: var(--sidebar-link-hover-bg); color: #ffffff; border-left-color: var(--sidebar-link-hover-bg); }
        /* Active link styling */
        #sidebar .nav-link.active { background-color: var(--sidebar-link-hover-bg); color: var(--sidebar-link-active-color); font-weight: 500; border-left-color: var(--sidebar-link-active-bg); /* Active indicator */ }
        /* Active state for dropdown toggle when its child is active */
        #sidebar .nav-item.dropdown .nav-link.active-parent { background-color: var(--sidebar-link-hover-bg); color: var(--sidebar-link-active-color); border-left-color: var(--sidebar-link-hover-bg); }

        #sidebar .sidebar-heading { padding: 0.5rem 1.5rem; font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: .05em; margin-top: 1rem; }
        #sidebar .logo-area { padding: 1rem 1.5rem; /* Adjusted padding */ color: #ffffff; font-size: 1.5rem; font-weight: bold; text-align: center; border-bottom: 1px solid #334155; margin-bottom: 1rem; flex-shrink: 0; background-color: rgba(0,0,0,0.1); /* Slight darker bg for logo */ }
        #sidebar .logo-area i { margin-right: 0.5rem; }
        #sidebar .sidebar-menu { flex-grow: 1; overflow-y: auto; padding-bottom: 1rem; /* Space at bottom */}
        #sidebar .sidebar-footer { flex-shrink: 0; padding: 1rem 0; text-align: center; border-top: 1px solid #334155; margin-top: auto; /* Push footer down */ }
        #sidebar .sidebar-footer small { color: var(--sidebar-link-color); opacity: 0.6; font-size: 0.75rem;}
        /* Dropdown */
        #sidebar .dropdown-toggle::after { display: none; }
        #sidebar .dropdown-menu { background-color: var(--dropdown-bg); border-radius: 0.375rem; border: 1px solid var(--sidebar-link-hover-bg); padding: 0.5rem 0; margin-top: 0.25rem !important; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); min-width: 200px; z-index: 1031; }
        #sidebar .dropdown-item { color: var(--sidebar-link-color); padding: 0.6rem 1.5rem; font-size: 0.9rem; display: flex; align-items: center; transition: background-color 0.2s ease; }
        #sidebar .dropdown-item i { margin-right: 0.8rem; font-size: 1rem; opacity: 0.8; width: 20px; text-align: center; }
        #sidebar .dropdown-item:hover, #sidebar .dropdown-item:focus { background-color: var(--dropdown-item-hover-bg); color: #ffffff; }
        #sidebar .dropdown-item.active, #sidebar .dropdown-item:active { background-color: var(--sidebar-link-active-bg); color: var(--sidebar-link-active-color); }
        #sidebar .dropdown-item.placeholder-link { color: #94a3b8; cursor: not-allowed; display: flex; justify-content: space-between; }
        #sidebar .dropdown-item.placeholder-link:hover { background-color: transparent; color: #94a3b8; }
        #sidebar .dropdown-item .chevron-placeholder { font-size: 0.7rem; opacity: 0.6; }
        #sidebar .dropdown-divider { border-color: var(--sidebar-link-hover-bg); margin: 0.5rem 0;}
        /* Main Content */
        #main-content { margin-left: var(--sidebar-width); padding: 0; width: calc(100% - var(--sidebar-width)); transition: margin-left 0.3s ease, width 0.3s ease; overflow-x: hidden; }
        .top-bar { background-color: #ffffff; padding: 0.8rem 1.5rem; border-bottom: 1px solid var(--card-border-color); display: flex; justify-content: space-between; align-items: center; }
        .top-bar .breadcrumb { margin-bottom: 0; font-size: 0.9rem; }
        .top-bar .breadcrumb-item a { color: var(--sidebar-link-active-bg); text-decoration: none;}
        .top-bar .breadcrumb-item.active { color: var(--text-muted-color); }
        .top-bar .user-info a { text-decoration: none; color: var(--text-muted-color); font-size: 0.9rem;}
        .top-bar .user-info i { margin-right: 0.5rem; }
        .content-wrapper { padding: 1.5rem; }
        .card { border: none; box-shadow: 0 1px 3px rgba(0,0,0,.05), 0 1px 2px rgba(0,0,0,.03); margin-bottom: 1.5rem; border-radius: 0.375rem; }
        .card-header { background-color: #fff; border-bottom: 1px solid var(--card-border-color); font-weight: 600; font-size: 0.95rem; padding: 1rem 1.25rem; }
        .card-body { padding: 1.25rem; }
        /* Leave Balance Circles */
        .leave-balance-circle { width: 70px; height: 70px; border-radius: 50%; background-color: #e0f2fe; border: 4px solid #7dd3fc; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.8rem; font-weight: bold; color: #0c4a6e; line-height: 1.2; margin: 0 auto 0.5rem auto; }
        .leave-balance-circle .days { font-size: 1.1rem; display: block; }
        .leave-balance-label { font-size: 0.7rem; color: var(--text-muted-color); text-transform: uppercase; font-weight: 600; letter-spacing: 0.02em;}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="logo-area">
             <i class="bi bi-person-workspace"></i> HRMS
        </div>

        <div class="sidebar-menu">
            <ul class="nav flex-column">
                <!-- Home Link (Points to correct dashboard) -->
                <li class="nav-item">
                    <a class="nav-link {{ 'active' if request.endpoint == ('admin_dashboard' if is_admin else 'dashboard') else '' }}"
                       href="{{ url_for('admin_dashboard' if is_admin else 'dashboard') }}">
                        <i class="bi bi-house-door-fill"></i> Home
                    </a>
                </li>

                <!-- Standard User Links (Hidden for Admins) -->
                {% if not is_admin %}
                <li class="nav-item dropdown">
                    {% set me_active = request.endpoint in ['view_attendance', 'view_leaves', 'apply_leave'] %}
                    <a class="nav-link dropdown-toggle {{ 'active-parent' if me_active else '' }}" href="#" id="meDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> <i class="bi bi-person-fill"></i> Me </a>
                    <ul class="dropdown-menu" aria-labelledby="meDropdown">
                        <li><a class="dropdown-item {{ 'active' if request.endpoint == 'view_attendance' else '' }}" href="{{ url_for('view_attendance') }}"><i class="bi bi-calendar-check"></i> Attendance</a></li>
                        <li><a class="dropdown-item {{ 'active' if 'leave' in request.endpoint else '' }}" href="{{ url_for('view_leaves') }}"><i class="bi bi-calendar-x"></i> Leave</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-graph-up"></i> Performance</span><i class="bi bi-chevron-right chevron-placeholder"></i></a></li>
                        <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-briefcase"></i> Expenses & Travel</span><i class="bi bi-chevron-right chevron-placeholder"></i></a></li>
                        <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-grid-1x2"></i> Apps</span></a></li>
                    </ul>
                </li>
                 <li class="nav-item"> <a class="nav-link disabled" href="#"><i class="bi bi-inbox-fill"></i> Inbox</a> </li>
                 <li class="sidebar-heading">Work</li>
                 <li class="nav-item"> <a class="nav-link disabled" href="#"><i class="bi bi-people-fill"></i> My Team</a> </li>
                <li class="sidebar-heading">Finance</li>
                <li class="nav-item dropdown">
                    {% set finance_active = request.endpoint == 'view_payslips' %}
                    <a class="nav-link dropdown-toggle {{ 'active-parent' if finance_active else '' }}" href="#" id="financeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> <i class="bi bi-currency-dollar"></i> My Finances </a>
                    <ul class="dropdown-menu" aria-labelledby="financeDropdown">
                         <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-file-earmark-text"></i> Summary</span></a></li>
                        <li><a class="dropdown-item {{ 'active' if request.endpoint == 'view_payslips' else '' }}" href="{{ url_for('view_payslips') }}"><i class="bi bi-wallet2"></i> My Pay</a></li>
                        <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-receipt"></i> Manage Tax</span><i class="bi bi-chevron-right chevron-placeholder ms-auto"></i></a></li>
                    </ul>
                </li>
                 <li class="sidebar-heading">Organization</li>
                 <li class="nav-item dropdown">
                     <a class="nav-link dropdown-toggle" href="#" id="orgDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> <i class="bi bi-diagram-3-fill"></i> Org </a>
                     <ul class="dropdown-menu" aria-labelledby="orgDropdown">
                         <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-people"></i> Employees</span><i class="bi bi-chevron-right chevron-placeholder ms-auto"></i></a></li>
                        <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-file-earmark-richtext"></i> Documents</span><i class="bi bi-chevron-right chevron-placeholder ms-auto"></i></a></li>
                        <li><hr class="dropdown-divider"></li>
                         <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-megaphone"></i> Engage</span></a></li>
                     </ul>
                 </li>
                {% endif %} {# End standard user links #}

                <!-- ADMIN SECTION -->
                {% if is_admin %}
                    <li class="sidebar-heading">Admin Portal</li>
                    <li class="nav-item">
                        <a class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard' else '' }}" href="{{ url_for('admin_dashboard') }}"> <i class="bi bi-speedometer2"></i> Admin Dashboard </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {{ 'active' if request.endpoint == 'admin_manage_users' else '' }}" href="{{ url_for('admin_manage_users') }}"> <i class="bi bi-people-fill"></i> Manage Users </a>
                    </li>
                    <li class="nav-item">
                        {# Highlight if on manage leaves or actioning a leave #}
                        <a class="nav-link {{ 'active' if 'admin' in request.endpoint and 'leave' in request.endpoint else '' }}" href="{{ url_for('admin_manage_leaves') }}"> <i class="bi bi-calendar2-check-fill"></i> Manage Leaves </a>
                    </li>
                    {# Add more admin links here (e.g., Manage Attendance, Upload Payslips) #}
                     <li class="nav-item">
                        <a class="nav-link disabled placeholder-link" href="#"> <i class="bi bi-gear-fill"></i> Settings </a>
                    </li>
                {% endif %}
                <!-- END ADMIN SECTION -->
            </ul>
        </div> <!-- /sidebar-menu -->

         <div class="sidebar-footer">
             <small>© {{ now.year }} Your Company</small>
         </div>
    </div> <!-- /sidebar -->

    <!-- Main Content Area -->
    <div id="main-content">
        <!-- Top Bar -->
         <div class="top-bar">
             <div>
                 <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0 m-0">
                         {# Determine Base Title based on Admin/User #}
                         {% set base_url = url_for('admin_dashboard' if is_admin else 'dashboard') %}
                         {% set base_title = "Admin" if is_admin else "Home" %}
                        <li class="breadcrumb-item"><a href="{{ base_url }}">{{ base_title }}</a></li>

                        {# Determine Page Title #}
                        {% set page_title = request.endpoint | replace('admin_', '') | replace('_', ' ') | title %}
                        {% if request.endpoint == 'view_attendance' %} {% set page_title = 'Attendance' %}
                        {% elif 'leave' in request.endpoint and 'admin' not in request.endpoint %} {% set page_title = 'Leave' %}
                        {% elif request.endpoint == 'view_payslips' %} {% set page_title = 'My Pay' %}
                        {% elif 'admin' in request.endpoint and 'leave' in request.endpoint %} {% set page_title = 'Manage Leaves' %}
                        {% elif request.endpoint == 'admin_manage_users' %} {% set page_title = 'Manage Users' %}
                        {% endif %}
                        {# Show page title only if not on the main dashboard for that user type #}
                        {% if request.endpoint != 'dashboard' and request.endpoint != 'admin_dashboard' %}
                         <li class="breadcrumb-item active" aria-current="page">{{ page_title }}</li>
                        {% endif %}
                    </ol>
                </nav>
             </div>
             <div class="user-info d-flex align-items-center"> {# Use flex for alignment #}
                 {% if session.user_id %}
                    <span class="me-3 text-nowrap"><i class="bi bi-person-circle me-1"></i> {{ session.username }} {% if is_admin %}<span class="badge bg-danger-subtle text-danger-emphasis border border-danger-subtle rounded-pill ms-1 small">Admin</span>{% endif %}</span>
                    <a href="{{ url_for('logout') }}" title="Logout" class="text-danger text-nowrap"> <i class="bi bi-box-arrow-right"></i> Logout </a>
                 {% else %}
                     <a href="{{ url_for('login') }}"> <i class="bi bi-box-arrow-in-right"></i> Login </a>
                 {% endif %}
             </div>
         </div>

        <!-- Content Wrapper with Padding -->
        <div class="content-wrapper">
            <!-- Flash Messages Container -->
             <div id="flash-message-container" style="position: relative; z-index: 1050;"> {# Ensure flash messages appear above some content #}
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            {# Map simple categories to bootstrap types #}
                            {% set alert_type = category if category in ['primary', 'secondary', 'success', 'danger', 'warning', 'info', 'light', 'dark'] else 'info' %}
                            <div class="alert alert-{{ alert_type }} alert-dismissible fade show mb-4 shadow-sm" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
             </div>
            <!-- Page Specific Content -->
            <main>
                {% block content %}{% endblock %}
            </main>
        </div> {# End content-wrapper #}

    </div> {# End main-content #}

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Page Specific Scripts -->
    {% block scripts %}{% endblock %}
</body>
</html>