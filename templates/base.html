<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HRMS Portal{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --sidebar-width: 260px;
            --sidebar-bg: #1e293b;
            --sidebar-link-color: #cbd5e1;
            --sidebar-link-hover-bg: #334155;
            --sidebar-link-active-bg: #0ea5e9;
            --sidebar-link-active-color: #ffffff;
            --dropdown-bg: #293548;
            --dropdown-item-hover-bg: #3e4f66;
        }

        body { background-color: #f1f5f9; display: flex; }
        #sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background-color: var(--sidebar-bg); padding-top: 1rem; overflow-y: auto; transition: width 0.3s ease; z-index: 1030; }
        #sidebar .nav-link { color: var(--sidebar-link-color); padding: 0.75rem 1.5rem; display: flex; align-items: center; font-size: 0.95rem; white-space: nowrap; }
        #sidebar .nav-link i { margin-right: 0.8rem; font-size: 1.2rem; width: 25px; text-align: center; }
        #sidebar .nav-link:hover { background-color: var(--sidebar-link-hover-bg); color: #ffffff; }
        #sidebar .nav-link.active { background-color: var(--sidebar-link-active-bg); color: var(--sidebar-link-active-color); font-weight: 500; }
        #sidebar .sidebar-heading { padding: 0.5rem 1.5rem; font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: .05em; margin-top: 1rem; }
        #sidebar .logo-area { padding: 0.5rem 1.5rem 1.5rem 1.5rem; color: #ffffff; font-size: 1.5rem; font-weight: bold; text-align: center; border-bottom: 1px solid #334155; margin-bottom: 1rem; }
        #sidebar .logo-area i { margin-right: 0.5rem; }

        /* Dropdown Styling */
        #sidebar .dropdown-toggle::after { display: none; }
        #sidebar .dropdown-menu { background-color: var(--dropdown-bg); border-radius: 0.375rem; border: 1px solid var(--sidebar-link-hover-bg); padding: 0.5rem 0; margin-top: 0.25rem !important; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); min-width: 200px; }
        #sidebar .dropdown-item { color: var(--sidebar-link-color); padding: 0.6rem 1.5rem; font-size: 0.9rem; display: flex; align-items: center; }
        #sidebar .dropdown-item i { margin-right: 0.8rem; font-size: 1rem; opacity: 0.8; }
        #sidebar .dropdown-item:hover,
        #sidebar .dropdown-item:focus { background-color: var(--dropdown-item-hover-bg); color: #ffffff; }
        #sidebar .dropdown-item.active,
        #sidebar .dropdown-item:active { background-color: var(--sidebar-link-active-bg); color: var(--sidebar-link-active-color); }
        #sidebar .dropdown-item.placeholder-link { color: #94a3b8; cursor: not-allowed; display: flex; justify-content: space-between; }
        #sidebar .dropdown-item.placeholder-link:hover { background-color: transparent; color: #94a3b8; }
        #sidebar .dropdown-item .chevron-placeholder { font-size: 0.7rem; opacity: 0.6; }

        #main-content { margin-left: var(--sidebar-width); padding: 0; width: calc(100% - var(--sidebar-width)); transition: margin-left 0.3s ease, width 0.3s ease; overflow-x: hidden; }
        .top-bar { background-color: #ffffff; padding: 0.8rem 1.5rem; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .top-bar .breadcrumb { margin-bottom: 0; }
        .top-bar .user-info a { text-decoration: none; color: #64748b; }
        .top-bar .user-info i { margin-right: 0.5rem; }
        .content-wrapper { padding: 1.5rem; }
        .card { border: none; box-shadow: 0 1px 3px rgba(0,0,0,.1); margin-bottom: 1.5rem; }
        .card-header { background-color: #fff; border-bottom: 1px solid #e2e8f0; font-weight: 600; padding: 1rem 1.25rem; }

    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="logo-area">
             <i class="bi bi-person-workspace"></i> HRMS
        </div>

        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {{ 'active' if request.endpoint == 'dashboard' else '' }}" href="{{ url_for('dashboard') }}">
                    <i class="bi bi-house-door-fill"></i> Home
                </a>
            </li>

            <!-- "Me" Section Dropdown -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle {{ 'active' if request.endpoint in ['view_attendance', 'view_leaves', 'apply_leave'] else '' }}"
                   href="#" id="meDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person-fill"></i> Me
                </a>
                <ul class="dropdown-menu" aria-labelledby="meDropdown">
                    <li><a class="dropdown-item {{ 'active' if request.endpoint == 'view_attendance' else '' }}" href="{{ url_for('view_attendance') }}"><i class="bi bi-calendar-check"></i> Attendance</a></li>
                    <li><a class="dropdown-item {{ 'active' if 'leave' in request.endpoint else '' }}" href="{{ url_for('view_leaves') }}"><i class="bi bi-calendar-x"></i> Leave</a></li>
                    <li><hr class="dropdown-divider" style="border-color: var(--sidebar-link-hover-bg);"></li>
                    <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-graph-up"></i> Performance</span><i class="bi bi-chevron-right chevron-placeholder"></i></a></li>
                    <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-briefcase"></i> Expenses & Travel</span><i class="bi bi-chevron-right chevron-placeholder"></i></a></li>
                    <li><a class="dropdown-item placeholder-link" href="#"><span><i class="bi bi-grid-1x2"></i> Apps</span></a></li>
                </ul>
            </li>

             <li class="nav-item">
                <a class="nav-link disabled" href="#"> {# Example: Inbox section #}
                    <i class="bi bi-inbox-fill"></i> Inbox
                </a>
            </li>

             <li class="sidebar-heading">Work</li>
             <li class="nav-item">
                <a class="nav-link disabled" href="#"> {# Example: My Team section #}
                    <i class="bi bi-people-fill"></i> My Team
                </a>
            </li>

            <!-- === MODIFIED "Finance" Section === -->
            <li class="sidebar-heading">Finance</li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle {{ 'active' if request.endpoint == 'view_payslips' else '' }}"
                   href="#" id="financeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                   <i class="bi bi-currency-dollar"></i> My Finances
                </a>
                <ul class="dropdown-menu" aria-labelledby="financeDropdown">
                     <li>
                        <a class="dropdown-item placeholder-link" href="#">
                             <span><i class="bi bi-file-earmark-text"></i> Summary</span>
                             {# No chevron for summary usually #}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item {{ 'active' if request.endpoint == 'view_payslips' else '' }}"
                           href="{{ url_for('view_payslips') }}">
                           <i class="bi bi-wallet2"></i> My Pay
                           {# Keka uses chevron even here, add if desired #}
                           {# <i class="bi bi-chevron-right chevron-placeholder ms-auto"></i> #}
                        </a>
                    </li>
                     <li>
                        <a class="dropdown-item placeholder-link" href="#">
                            <span><i class="bi bi-receipt"></i> Manage Tax</span>
                            <i class="bi bi-chevron-right chevron-placeholder ms-auto"></i> {# Added ms-auto to push right #}
                        </a>
                    </li>
                </ul>
            </li>
            {# Standalone Payslips link is now removed as it's under My Finances -> My Pay #}
            <!-- === END MODIFIED "Finance" Section === -->


             <li class="sidebar-heading">Organization</li>
             <li class="nav-item">
                <a class="nav-link disabled" href="#"> {# Example: Org section #}
                    <i class="bi bi-diagram-3-fill"></i> Org
                </a>
            </li>
              <li class="nav-item">
                <a class="nav-link disabled" href="#"> {# Example: Engage section #}
                    <i class="bi bi-megaphone-fill"></i> Engage
                </a>
            </li>
        </ul>
         <div class="mt-auto p-3 text-center">
             <small style="color: var(--sidebar-link-color); opacity: 0.6;">Â© {{ now.year }} Your Company</small>
         </div>
    </div>

    <!-- Main Content Area -->
    <div id="main-content">
        <!-- Top Bar -->
         <div class="top-bar">
             <div>
                 <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent p-0 m-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Home</a></li>
                        {% set page_title = request.endpoint | replace('_', ' ') | title %}
                        {% if request.endpoint == 'view_attendance' %} {% set page_title = 'Attendance' %}
                        {% elif 'leave' in request.endpoint %} {% set page_title = 'Leave' %}
                        {% elif request.endpoint == 'view_payslips' %} {% set page_title = 'My Pay' %} {# Updated Breadcrumb Title #}
                        {% endif %}

                        {% if request.endpoint != 'dashboard' %}
                         <li class="breadcrumb-item active" aria-current="page">{{ page_title }}</li>
                        {% endif %}
                    </ol>
                </nav>
             </div>
             <div class="user-info">
                 {% if session.user_id %}
                    <a href="{{ url_for('logout') }}">
                        <i class="bi bi-box-arrow-right"></i> Logout ({{ session.username }})
                    </a>
                 {% else %}
                     <a href="{{ url_for('login') }}">
                         <i class="bi bi-box-arrow-in-right"></i> Login
                     </a>
                 {% endif %}
             </div>
         </div>

        <!-- Content Wrapper with Padding -->
        <div class="content-wrapper">
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        {% set alert_type = category if category in ['primary', 'secondary', 'success', 'danger', 'warning', 'info', 'light', 'dark'] else 'info' %}
                        <div class="alert alert-{{ alert_type }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Page Specific Content -->
            <main>
                {% block content %}{% endblock %}
            </main>
        </div> {# End content-wrapper #}

    </div> {# End main-content #}

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- Page Specific Scripts -->
    {% block scripts %}{% endblock %}
</body>
</html>